# NeoLan Rust 示例

本目录包含 NeoLan 项目的 Rust 示例程序，用于演示各种网络通信功能和与第三方软件的交互。

## 示例列表

### 1. feiq_discovery - 飞秋用户发现

演示如何使用 NeoLan 的网络模块与飞秋（FeiQ）进行 IPMsg 协议通信。

#### 功能特性
- ✅ 发送上线广播（兼容飞秋/IPMsg 协议）
- ✅ 自动发现局域网内的飞秋用户
- ✅ 显示在线用户列表（包括用户名、主机名、IP 地址）
- ✅ 每 30 秒重新广播一次以维持在线状态
- ✅ 支持优雅退出（Ctrl+C）

#### 编译运行
```bash
# 在 src-tauri 目录下运行
cd src-tauri

# 编译示例
cargo build --example feiq_discovery

# 运行示例
cargo run --example feiq_discovery
```

#### 使用说明
1. 确保飞秋在同一局域网运行
2. 启动此程序后会自动发现飞秋用户
3. 按 `Ctrl+C` 显示最终用户列表并退出

#### 输出示例
```
╔═══════════════════════════════════════════════════════════════╗
║              NeoLan - 飞秋（FeiQ）交互示例                    ║
╚═══════════════════════════════════════════════════════════════╝

📡 飞秋发现器启动
📍 本机: user@DESKTOP-ABC123
🔌 绑定端口: 2425

📢 已发送上线广播 (packet_id: 1)
🔍 正在搜索飞秋用户...

👤 发现用户: 张三 (192.168.1.100)
   主机名: ZHANGSAN-PC
   端口: 2425

📊 当前在线用户: 1 人
```

#### 技术细节
- 使用 UDP 广播（255.255.255.255:2425）发送上线消息
- 实现 IPMsg 协议解析器（版本 1）
- 支持以下消息类型：
  - `IPMSG_BR_ENTRY` (0x00000010): 广播入场
  - `IPMSG_ANSENTRY` (0x00000011): 入场应答
  - `IPMSG_OKSEND` (0x00000020): 可以发送

## IPMsg 协议说明

### 协议格式
```
version:packet_id:sender_name:sender_host:command:extra
```

### 字段说明
| 字段 | 类型 | 说明 |
|------|------|------|
| version | u8 | 协议版本（通常为 1） |
| packet_id | u64 | 数据包 ID（递增） |
| sender_name | string | 发送者用户名 |
| sender_host | string | 发送者主机名 |
| command | u32 | 命令类型 |
| extra | string | 附加内容（可选） |

### 常用命令
| 命令 | 值 | 说明 |
|------|-----|------|
| IPMSG_BR_ENTRY | 0x00000010 | 广播入场 |
| IPMSG_ANSENTRY | 0x00000011 | 入场应答 |
| IPMSG_OKSEND | 0x00000020 | 可以发送 |
| IPMSG_SENDMSG | 0x00000004 | 发送消息 |

## 兼容性

本示例兼容以下软件：
- ✅ 飞秋（FeiQ）
- ✅ 飞鸽传书（IPMsg）
- ✅ 其他支持 IPMsg 协议的 LAN 通讯软件

## 故障排除

### 端口被占用
如果看到错误 "端口 2425 可能被占用"，请：
1. 关闭正在运行的飞秋或其他 IPMsg 软件
2. 或修改示例代码中的端口号

### 无法发现用户
如果无法发现飞秋用户，请检查：
1. 确保飞秋正在运行
2. 检查防火墙是否允许端口 2425 的 UDP 通信
3. 确保两台电脑在同一局域网内
4. 检查飞秋的端口设置（默认应为 2425）

## 更多示例

即将推出更多示例：
- `peer_chat` - 与飞秋用户聊天
- `file_transfer` - 文件传输示例
- `lan_messenger` - 完整的局域网通讯工具

## 许可证

MIT License
